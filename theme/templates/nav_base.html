{% extends "base.html" %}

{% block description %}{{ SITENAME }}{% endblock description %}

{% block content %}
  <header class="navbar">
  <a class="lockup" href="/">
    {% if page is defined and page.theme == "light" %}
      {% include 'svg/lockup-dark.svg' %}
    {% else %}
      {% include 'svg/lockup-light.svg' %}
    {% endif %}
  </a>
    <nav {% if page is defined and page.theme == "light" %} class="light-bg" {% endif %}>
      {% if DISPLAY_PAGES_ON_MENU %}
        {% for p in pages %}
          <a href="{{ SITEURL }}/{{ p.url }}" {% if p==page %} aria-current="page" {% endif %}  role="menuitem"><span class="navtext">{{ p.title }}</span></a>
        {% endfor %}
      {% endif %}
    </nav>
  </header>

  <main>
    {% block section %} {% endblock section %}
  </main>

  <footer>
    <h1>Contact Us</h1>
    <form id="contact-form" action="http://localhost:8008" method="post">
      <div class="contact-boxes">
        <div class="contact-form">
          <div class="input-row">
            <div class="input-group">
              <label for="name">Name</label>
              <input type="text" id="name" name="name" required>
            </div>
            <div class="input-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" required>
            </div>
          </div>
          <div class="input-group">
            <label for="message">Message</label>
            <textarea id="message" name="message" required></textarea>
          </div>
        </div>
        <div class="contact-info">
          <div class="wordmark">
            {% include 'svg/wordmark.svg' %}
          </div>
          <div class="contact-details">
            <div class="contact-item">
              {% include 'svg/lucide-mail.svg' %}
              <span>{{ CONTACT_EMAIL }}</span>
            </div>
            <div class="contact-item">
              {% include 'svg/lucide-phone.svg' %}
              <span>{{ CONTACT_PHONE }}</span>
            </div>
            <div class="contact-item">
              {% include 'svg/lucide-map-pin.svg' %}
              <span>{{ CONTACT_ADDRESS }}</span>
            </div>
          </div>
          <div>
            <span>&copy; {{ SITENAME }} {{ YEAR }}</span>
          </div>
        </div>
      </div>
      <input type="submit" value="Submit" class="submit-button">
    </form>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('contact-form');

      form.addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          message: document.getElementById('message').value
        };

        fetch('https://defaultd32e878d4f2b4379969c8438dd78af.5e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/e65b4015192d42689146f47a14118196/triggers/manual/paths/invoke/?api-version=1&tenantId=tId&environmentName=Default-d32e878d-4f2b-4379-969c-8438dd78af5e&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Gxhu6h5VCtrjTVFc-v91-KpF1uJgB9RHQFLCuPj6SBY', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        })
        .then(response => {
          if (response.ok) {
            return response;
          }
          throw new Error('Network response was not ok');
        })
        .then(data => {
          // TODO: Make some kind of notification to use, not an alert
          form.reset();
        })
        .catch(error => {
          console.error('Error:', error);
          alert('There was an error sending your message. Please try again later.');
        });
      });
    });
  </script>
{% endblock content %}
